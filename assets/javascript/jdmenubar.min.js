/**
 * @file jdmenubar javascript library.
 * See {@link https://github.com/midstar/jdmenubar} for a full description.
 * @copyright Joel Midstjärna 2021
 * @license MIT
 */
class MenuBar{constructor(e,t){this.menuBarElement=e,this.menuItems=t,this.stateOpen=!1,this.stateFocus=!1;const n=this;e.classList.add("jdmenu-bar"),e.onmouseleave=function(){n.stateFocus=!1},e.onmouseenter=function(){n.stateFocus=!0},document.addEventListener("click",(function(){n.stateOpen&&!1===n.stateFocus&&n.closeAll(n)})),document.body.addEventListener("keydown",(function(e){"Escape"===e.key&&n.stateOpen&&n.closeAll(n)})),this.parseMenuItems(e,t)}parseMenuItems(e,t){const n=this,s=e===this.menuBarElement;for(let u=0;u<t.length;u++){const i=t[u];if("text"in i==!1){"separator"in i&&!0===i.separator&&e.appendChild(document.createElement("hr"));continue}const l=document.createElement("div");if(l.classList.add("jdmenu-item"),l.jdmenu_menu=e,e.appendChild(l),!1===s){const e=document.createElement("span"),t=document.createElement("span"),n=document.createElement("span");l.appendChild(e),l.appendChild(t),l.appendChild(n),"icon"in i&&(e.innerHTML=i.icon),t.innerHTML=i.text,"subMenuItems"in i?(n.classList.add("jdmenu-submenu-symbol"),n.innerText="▶"):"shortcut"in i&&(n.innerHTML=i.shortcut)}else l.innerHTML=i.text;if("enabled"in i&&!1===i.enabled)l.classList.add("jdmenu-item-disabled");else if("subMenuItems"in i){const t=document.createElement("div");t.classList.add("jdmenu-submenu"),t.jdmenu_parentItem=l,t.jdmenu_parentMenu=e,e.appendChild(t),this.parseMenuItems(t,i.subMenuItems,!1),s&&(l.onclick=function(){n.toggleSubMenu(n,t)}),l.onmouseover=function(){n.stateOpen&&n.openSubMenu(n,t)}}else!1===s&&(l.onmouseover=function(){n.openSubMenu(n,e)},"handler"in i&&(l.onclick=function(){n.closeAll(n),i.handler()}))}}toggleSubMenu(e,t){"block"===t.style.display?this.closeSubMenu(e,t):this.openSubMenu(e,t)}closeSubMenu(e,t){const n=t.jdmenu_parentItem;t.style.display="none",n.jdmenu_menu===e.menuBarElement&&(e.stateOpen=!1)}openSubMenu(e,t){this.closeAll(e),e.stateOpen=!0;let n=t;for(;n!==e.menuBarElement;)n.style.display="block",n=n.jdmenu_parentMenu;const s=t.jdmenu_parentItem.getBoundingClientRect();t.jdmenu_parentMenu===e.menuBarElement?(t.style.left=s.left,t.style.top=s.bottom):(t.style.left=s.right,t.style.top=s.top)}closeAll(e){const t=e.menuBarElement.getElementsByClassName("jdmenu-submenu");for(const e of t)e.style.display="none";e.stateOpen=!1}getItemWithId(e){return this.getItemWithIdOf(e,this.menuItems)}getItemWithIdOf(e,t){for(let n=0;n<t.length;n++){const s=t[n];if("id"in s&&s.id===e)return s;if("subMenuItems"in s){const t=this.getItemWithIdOf(e,s.subMenuItems);if(null!=t)return t}}return null}update(){for(;this.menuBarElement.firstChild;)this.menuBarElement.removeChild(this.menuBarElement.firstChild);this.stateOpen=!1,this.stateFocus=!1,this.parseMenuItems(this.menuBarElement,this.menuItems)}}
